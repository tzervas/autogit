# =============================================================================
# AutoGit Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values.
# NEVER commit your .env file to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# GitLab CE Configuration
# -----------------------------------------------------------------------------

# Root password for GitLab (required on first run)
# Generate a secure password: openssl rand -base64 32
GITLAB_ROOT_PASSWORD=CHANGE_ME_SECURE_PASSWORD

# GitLab external URL (how users access GitLab)
# For local deployment: http://localhost:3000
# For network deployment: http://your-server-ip:3000
GITLAB_OMNIBUS_CONFIG=external_url "http://localhost:3000"

# Port mappings (optional, defaults shown)
GITLAB_HTTP_PORT=3000
GITLAB_HTTPS_PORT=3443
GITLAB_SSH_PORT=2222
GITLAB_REGISTRY_PORT=5050

# -----------------------------------------------------------------------------
# Runner Coordinator Configuration
# -----------------------------------------------------------------------------

# GitLab API Token (required)
# Create at: GitLab → Settings → Access Tokens
# Scopes needed: api, read_api, read_repository
GITLAB_TOKEN=glpat-your-token-here

# GitLab URL (internal Docker network URL)
GITLAB_URL=http://autogit-git-server:3000

# Runner Registration Token (required)
# Find at: GitLab → Admin → CI/CD → Runners → Registration Token
GITLAB_RUNNER_REGISTRATION_TOKEN=GR1348941your-token-here

# Database URL for runner coordinator (optional, defaults to SQLite)
DATABASE_URL=sqlite:///./runner_coordinator.db

# Runner image (optional, defaults shown)
RUNNER_IMAGE=gitlab/gitlab-runner:alpine

# Runner resource limits (optional, defaults shown)
RUNNER_CPU_LIMIT=4.0
RUNNER_MEMORY_LIMIT=6g

# Runner lifecycle configuration (optional, defaults shown)
RUNNER_COOLDOWN_MINUTES=5
MAX_IDLE_RUNNERS=0

# Docker network for runners (optional)
RUNNER_NETWORK=autogit-network

# -----------------------------------------------------------------------------
# Rootless Docker Configuration (if using rootless Docker)
# -----------------------------------------------------------------------------

# Path to the Docker socket on the host
# For rootless: /run/user/1000/docker.sock
# For standard: /var/run/docker.sock
RUNNER_DOCKER_SOCKET=/var/run/docker.sock

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------

# Homelab server IP address
HOMELAB_IP=192.168.1.170

# Coordinator API URL (constructed from HOMELAB_IP)
COORDINATOR_URL=http://${HOMELAB_IP}:8080

# -----------------------------------------------------------------------------
# Domain Configuration
# -----------------------------------------------------------------------------

# Base domain for all services
BASE_DOMAIN=example.com

# Service-specific hostnames (will be combined with BASE_DOMAIN)
GITLAB_HOSTNAME=gitlab
GRAFANA_HOSTNAME=grafana
TRAEFIK_HOSTNAME=traefik
RUNNER_API_HOSTNAME=runner
REGISTRY_HOSTNAME=registry

# Full domain names (auto-constructed)
GITLAB_FQDN=${GITLAB_HOSTNAME}.${BASE_DOMAIN}
GRAFANA_FQDN=${GRAFANA_HOSTNAME}.${BASE_DOMAIN}
TRAEFIK_FQDN=${TRAEFIK_HOSTNAME}.${BASE_DOMAIN}
RUNNER_API_FQDN=${RUNNER_API_HOSTNAME}.${BASE_DOMAIN}
REGISTRY_FQDN=${REGISTRY_HOSTNAME}.${BASE_DOMAIN}

# -----------------------------------------------------------------------------
# Email Configuration
# -----------------------------------------------------------------------------

# Admin email for Let's Encrypt and system notifications
ADMIN_EMAIL=admin@${BASE_DOMAIN}

# System service emails (used in bootstrap)
CI_EMAIL=ci@${BASE_DOMAIN}
API_EMAIL=api@${BASE_DOMAIN}
BACKUP_EMAIL=backup@${BASE_DOMAIN}

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------

# IP whitelist for security (comma-separated CIDR blocks)
IP_WHITELIST=192.168.1.0/24,10.0.0.0/8

# -----------------------------------------------------------------------------
# Docker Configuration
# -----------------------------------------------------------------------------

# Docker socket path
# For rootless: /run/user/1000/docker.sock
# For standard: /var/run/docker.sock
DOCKER_SOCKET=/var/run/docker.sock

# =============================================================================
# Quick Start
# =============================================================================
# 1. Copy this file to .env:
#    cp .env.example .env
#
# 2. Edit .env with your values (at minimum, set GITLAB_ROOT_PASSWORD)
#
# 3. Start the stack:
#    docker compose up -d
#
# 4. Wait for GitLab to start (first run takes ~5 minutes):
#    docker compose logs -f git-server
#
# 5. Access GitLab at http://localhost:3000
#    Login: root / <your GITLAB_ROOT_PASSWORD>
#
# 6. Create API token and runner registration token, update .env
#
# 7. Restart coordinator:
#    docker compose up -d runner-coordinator
# =============================================================================
# ============================================================================
#
# 1. Password is auto-generated on first run
# 2. Run: bash scripts/first-time-setup-complete.sh
# 3. Credentials stored in: ~/.autogit/
# 4. Never commit .env with real credentials!
