# =============================================================================
# AutoGit Kubernetes Deployment Configuration
# =============================================================================
# This file contains all configurable parameters for deploying AutoGit to
# Kubernetes using ArgoCD or Helmfile.
#
# Copy this file to .env.k8s and fill in your values:
#   cp .env.k8s.example .env.k8s
#
# NEVER commit your .env.k8s file to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Domain Configuration
# -----------------------------------------------------------------------------

# Base domain for all services (e.g., example.com, yourdomain.com)
DOMAIN=example.com

# Service-specific hostnames (will be combined with DOMAIN)
GITLAB_HOSTNAME=gitlab
GRAFANA_HOSTNAME=grafana
TRAEFIK_HOSTNAME=traefik
RUNNER_API_HOSTNAME=runner
REGISTRY_HOSTNAME=registry

# Full URLs (auto-constructed, or override if needed)
# GITLAB_URL=https://${GITLAB_HOSTNAME}.${DOMAIN}
# GRAFANA_URL=https://${GRAFANA_HOSTNAME}.${DOMAIN}

# -----------------------------------------------------------------------------
# TLS/SSL Configuration
# -----------------------------------------------------------------------------

# Email for Let's Encrypt certificate notifications
LETSENCRYPT_EMAIL=admin@example.com

# Cluster issuer to use (letsencrypt-staging or letsencrypt-prod)
CLUSTER_ISSUER=letsencrypt-staging

# -----------------------------------------------------------------------------
# GitLab Configuration
# -----------------------------------------------------------------------------

# GitLab API Token (Personal Access Token with api, read_api, read_repository scopes)
# Create at: GitLab → Settings → Access Tokens
GITLAB_TOKEN=glpat-xxxxxxxxxxxxxxxxxxxx

# GitLab Runner Registration Token
# Find at: GitLab → Admin → CI/CD → Runners → Registration Token
GITLAB_RUNNER_REGISTRATION_TOKEN=GR1348941xxxxxxxxxxxxxxxxxxxx

# GitLab root password (initial setup)
# Generate: openssl rand -base64 32
GITLAB_ROOT_PASSWORD=changeme-generate-secure-password

# GitLab resource configuration
GITLAB_WEBSERVICE_CPU_REQUEST=1
GITLAB_WEBSERVICE_CPU_LIMIT=4
GITLAB_WEBSERVICE_MEMORY_REQUEST=2Gi
GITLAB_WEBSERVICE_MEMORY_LIMIT=8Gi

GITLAB_SIDEKIQ_CPU_REQUEST=500m
GITLAB_SIDEKIQ_CPU_LIMIT=2
GITLAB_SIDEKIQ_MEMORY_REQUEST=1Gi
GITLAB_SIDEKIQ_MEMORY_LIMIT=4Gi

# -----------------------------------------------------------------------------
# Runner Coordinator Configuration
# -----------------------------------------------------------------------------

# Cooldown period in minutes before cleaning up idle runners
RUNNER_COOLDOWN_MINUTES=5

# Maximum number of idle runners to keep
MAX_IDLE_RUNNERS=0

# Runner coordinator log level (DEBUG, INFO, WARNING, ERROR)
COORDINATOR_LOG_LEVEL=INFO

# Database URL for runner coordinator (defaults to SQLite)
DATABASE_URL=sqlite:///./runner_coordinator.db

# -----------------------------------------------------------------------------
# Storage Configuration
# -----------------------------------------------------------------------------

# Kubernetes storage class (leave empty for default)
STORAGE_CLASS=

# GitLab storage size
GITLAB_STORAGE_SIZE=50Gi

# Runner coordinator storage size
COORDINATOR_STORAGE_SIZE=10Gi

# Prometheus storage size
PROMETHEUS_STORAGE_SIZE=20Gi

# Grafana storage size
GRAFANA_STORAGE_SIZE=5Gi

# Loki storage size
LOKI_STORAGE_SIZE=10Gi

# -----------------------------------------------------------------------------
# Observability Configuration
# -----------------------------------------------------------------------------

# Grafana admin password
# Generate: openssl rand -base64 32
GRAFANA_ADMIN_PASSWORD=changeme-generate-secure-password

# Enable monitoring stack (true/false)
ENABLE_MONITORING=true

# Enable logging stack (true/false)
ENABLE_LOGGING=true

# Enable tracing (true/false)
ENABLE_TRACING=false

# Prometheus retention period
PROMETHEUS_RETENTION=7d

# Loki retention period (days)
LOKI_RETENTION_DAYS=7

# -----------------------------------------------------------------------------
# Resource Profile
# -----------------------------------------------------------------------------

# Resource profile: minimal, standard, large
# - minimal: Development/testing (low resources)
# - standard: Production homelab (moderate resources)
# - large: Production cluster (high resources)
RESOURCE_PROFILE=standard

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------

# LoadBalancer IP for Traefik (optional, leave empty for auto-assign)
TRAEFIK_LOADBALANCER_IP=

# Enable network policies (true/false)
ENABLE_NETWORK_POLICIES=true

# -----------------------------------------------------------------------------
# ArgoCD Configuration
# -----------------------------------------------------------------------------

# ArgoCD namespace (if different from default)
ARGOCD_NAMESPACE=argocd

# Repository URL for ArgoCD to track
ARGOCD_REPO_URL=https://github.com/tzervas/autogit.git

# Target revision (branch, tag, or commit)
ARGOCD_TARGET_REVISION=main

# Sync policy: manual or automated
ARGOCD_SYNC_POLICY=automated

# Auto-prune removed resources (true/false)
ARGOCD_AUTO_PRUNE=true

# Self-heal on configuration drift (true/false)
ARGOCD_SELF_HEAL=true

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------

# Enable GitLab Container Registry (true/false)
ENABLE_GITLAB_REGISTRY=false

# Enable GitLab KAS (Kubernetes Agent Server) (true/false)
ENABLE_GITLAB_KAS=false

# Enable GitLab Pages (true/false)
ENABLE_GITLAB_PAGES=false

# Enable GitLab built-in Prometheus (true/false)
ENABLE_GITLAB_PROMETHEUS=false

# Enable GitLab built-in Grafana (true/false)
ENABLE_GITLAB_GRAFANA=false

# -----------------------------------------------------------------------------
# SMTP Configuration (Optional)
# -----------------------------------------------------------------------------

# Enable SMTP for email notifications
SMTP_ENABLED=false

# SMTP server address
SMTP_ADDRESS=smtp.example.com

# SMTP server port
SMTP_PORT=587

# SMTP username
SMTP_USERNAME=gitlab@example.com

# SMTP password (store in Kubernetes Secret)
# SMTP_PASSWORD=

# SMTP domain
SMTP_DOMAIN=example.com

# SMTP authentication method (plain, login, cram_md5)
SMTP_AUTHENTICATION=login

# Enable STARTTLS (true/false)
SMTP_ENABLE_STARTTLS=true

# -----------------------------------------------------------------------------
# External Services (Optional)
# -----------------------------------------------------------------------------

# Use external PostgreSQL instead of in-cluster (optional)
# EXTERNAL_POSTGRES_HOST=
# EXTERNAL_POSTGRES_PORT=5432
# EXTERNAL_POSTGRES_DATABASE=gitlabhq_production
# EXTERNAL_POSTGRES_USERNAME=gitlab
# EXTERNAL_POSTGRES_PASSWORD=

# Use external Redis instead of in-cluster (optional)
# EXTERNAL_REDIS_HOST=
# EXTERNAL_REDIS_PORT=6379
# EXTERNAL_REDIS_PASSWORD=

# -----------------------------------------------------------------------------
# Backup Configuration (Optional)
# -----------------------------------------------------------------------------

# Enable automatic backups (true/false)
ENABLE_BACKUPS=false

# Backup schedule (cron format)
BACKUP_SCHEDULE="0 2 * * *"

# Backup retention (days)
BACKUP_RETENTION_DAYS=30

# S3-compatible backup destination (optional)
# BACKUP_S3_BUCKET=
# BACKUP_S3_ENDPOINT=
# BACKUP_S3_ACCESS_KEY=
# BACKUP_S3_SECRET_KEY=

# =============================================================================
# Quick Start
# =============================================================================
# 1. Copy this file:
#    cp .env.k8s.example .env.k8s
#
# 2. Edit .env.k8s and set at minimum:
#    - DOMAIN (your base domain)
#    - LETSENCRYPT_EMAIL (for TLS certificates)
#    - GITLAB_TOKEN (after GitLab first boot)
#    - GITLAB_RUNNER_REGISTRATION_TOKEN (after GitLab first boot)
#    - GRAFANA_ADMIN_PASSWORD (for Grafana access)
#
# 3. Create Kubernetes secrets:
#    ./scripts/create-k8s-secrets.sh
#
# 4. Deploy using ArgoCD:
#    kubectl apply -f argocd/apps/root.yaml
#
#    Or using Helmfile:
#    helmfile -e production sync
#
# 5. For detailed instructions, see:
#    - docs/installation/kubernetes.md
#    - docs/installation/argocd.md
# =============================================================================
