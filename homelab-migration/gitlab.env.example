# GitLab Homelab Environment Configuration
# ═══════════════════════════════════════════════════════════════════════════════
# Copy this file to .env and customize values
# All values have sensible defaults - only override what you need
#
# Usage:
#   cp gitlab.env.example .env
#   # Edit .env as needed
#   docker compose -f docker-compose.gitlab.yml up -d
# ═══════════════════════════════════════════════════════════════════════════════

#───────────────────────────────────────────────────────────────────────────────
# EXTERNAL ACCESS
#───────────────────────────────────────────────────────────────────────────────
GITLAB_HOSTNAME=gitlab.vectorweight.com
GITLAB_EXTERNAL_URL=http://gitlab.vectorweight.com
TZ=UTC

# Ports (rootless Docker requires non-privileged ports)
HTTP_PORT=8080
HTTPS_PORT=8443
SSH_PORT=2222
GITLAB_SSH_PORT=2222

#───────────────────────────────────────────────────────────────────────────────
# RESOURCE ALLOCATION
# Sizing guide (pick ONE):
#
# MINIMAL (single user, occasional CI):
#   CPU_LIMIT=4.0, MEMORY_LIMIT=4G, PUMA_WORKERS=2, SIDEKIQ_CONCURRENCY=4
#
# HOMELAB (1-5 users, regular CI) [DEFAULT]:
#   CPU_LIMIT=6.0, MEMORY_LIMIT=6G, PUMA_WORKERS=2, SIDEKIQ_CONCURRENCY=6
#
# TEAM (5-20 users, heavy CI):
#   CPU_LIMIT=12.0, MEMORY_LIMIT=12G, PUMA_WORKERS=4, SIDEKIQ_CONCURRENCY=12
#
# BEAST MODE (20+ users, parallel CI):
#   CPU_LIMIT=24.0, MEMORY_LIMIT=32G, PUMA_WORKERS=8, SIDEKIQ_CONCURRENCY=25
#───────────────────────────────────────────────────────────────────────────────
CPU_LIMIT=6.0
CPU_RESERVE=2.0
MEMORY_LIMIT=6G
MEMORY_RESERVE=2G
SHM_SIZE=2gb

#───────────────────────────────────────────────────────────────────────────────
# APPLICATION WORKERS
#───────────────────────────────────────────────────────────────────────────────
PUMA_WORKERS=2
PUMA_THREADS=4
SIDEKIQ_CONCURRENCY=6
UNICORN_WORKERS=2
DB_POOL=15

#───────────────────────────────────────────────────────────────────────────────
# POSTGRESQL TUNING
# Ratio guide:
#   shared_buffers: 16% of MEMORY_LIMIT
#   effective_cache_size: 60% of MEMORY_LIMIT
#   maintenance_work_mem: 8% of MEMORY_LIMIT
#───────────────────────────────────────────────────────────────────────────────
PG_SHARED_BUFFERS=1GB
PG_CACHE_SIZE=4GB
PG_WORK_MEM=16MB
PG_MAINTENANCE_MEM=512MB
PG_MAX_WORKERS=6
PG_PARALLEL_WORKERS=4
PG_PARALLEL_GATHER=2
PG_PARALLEL_MAINT=2

#───────────────────────────────────────────────────────────────────────────────
# FEATURES (true/false)
#───────────────────────────────────────────────────────────────────────────────
ARTIFACTS_ENABLED=false
LFS_ENABLED=true
REGISTRY_ENABLED=false
PROMETHEUS_ENABLED=false
EXPORTER_ENABLED=false
SMTP_ENABLED=false
HTTPS_REDIRECT=false

#───────────────────────────────────────────────────────────────────────────────
# SECURITY
#───────────────────────────────────────────────────────────────────────────────
SESSION_EXPIRE_DAYS=7

#───────────────────────────────────────────────────────────────────────────────
# API TOKENS (for mirroring - populate after bootstrap)
# See: gitlab-credentials.env after running bootstrap-gitlab-users.sh
#───────────────────────────────────────────────────────────────────────────────
# GITLAB_TOKEN=
# GITHUB_PAT_MIRROR=
# GITLAB_PAT_MIRROR=
